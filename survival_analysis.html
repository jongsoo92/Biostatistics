<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>의학통계학(MED2104) - 9&nbsp; 생존분석</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./sample_size_in_clinical_trial.html" rel="next">
<link href="./logistic_regression.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="custom.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./survival_analysis.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">생존분석</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">의학통계학(MED2104)</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://jongsoo92.github.io/Biostatistics/tree/main/book/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-git"></i></a>
    <a href="./의학통계학-MED2104-.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공지사항</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">R 소개 및 기본사용법</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./descriptive_statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">기술통계</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probabilities_and_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">확률과 분포</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./compare_two_groups.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">두 집단 평균비교</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./compare_more_than_three_groups.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">세 집단 이상 평균비교</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./compare_two_proportions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">두 집단의 분율비교</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">회귀분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">로지스틱 회귀분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival_analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">생존분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sample_size_in_clinical_trial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Sample size in Clinical Trial</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#카플란마이어-생존곡선kaplan-meier-survival-curve" id="toc-카플란마이어-생존곡선kaplan-meier-survival-curve" class="nav-link active" data-scroll-target="#카플란마이어-생존곡선kaplan-meier-survival-curve"><span class="header-section-number">9.1</span> 카플란마이어 생존곡선(Kaplan-Meier survival curve)</a></li>
  <li><a href="#생존곡선-비교" id="toc-생존곡선-비교" class="nav-link" data-scroll-target="#생존곡선-비교"><span class="header-section-number">9.2</span> 생존곡선 비교</a>
  <ul class="collapse">
  <li><a href="#로그순위검정log-rank-test" id="toc-로그순위검정log-rank-test" class="nav-link" data-scroll-target="#로그순위검정log-rank-test"><span class="header-section-number">9.2.1</span> 로그순위검정(Log-rank test)</a></li>
  <li><a href="#breslow-test-tarone-ware-test" id="toc-breslow-test-tarone-ware-test" class="nav-link" data-scroll-target="#breslow-test-tarone-ware-test"><span class="header-section-number">9.2.2</span> Breslow test &amp; Tarone-Ware test</a></li>
  </ul></li>
  <li><a href="#콕스비례위험모형cox-proportional-hazard-model" id="toc-콕스비례위험모형cox-proportional-hazard-model" class="nav-link" data-scroll-target="#콕스비례위험모형cox-proportional-hazard-model"><span class="header-section-number">9.3</span> 콕스비례위험모형(Cox proportional hazard model)</a></li>
  <li><a href="#비례위험-가정검토" id="toc-비례위험-가정검토" class="nav-link" data-scroll-target="#비례위험-가정검토"><span class="header-section-number">9.4</span> 비례위험 가정검토</a>
  <ul class="collapse">
  <li><a href="#plot을-이용한-방법" id="toc-plot을-이용한-방법" class="nav-link" data-scroll-target="#plot을-이용한-방법"><span class="header-section-number">9.4.1</span> 1. plot을 이용한 방법</a></li>
  <li><a href="#time-dependent-cox-regression을-이용한-방법" id="toc-time-dependent-cox-regression을-이용한-방법" class="nav-link" data-scroll-target="#time-dependent-cox-regression을-이용한-방법"><span class="header-section-number">9.4.2</span> 2. Time dependent cox regression을 이용한 방법</a></li>
  <li><a href="#schoenfeld-residual을-이용한-방법" id="toc-schoenfeld-residual을-이용한-방법" class="nav-link" data-scroll-target="#schoenfeld-residual을-이용한-방법"><span class="header-section-number">9.4.3</span> 3. Schoenfeld residual을 이용한 방법</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-git"></i></div><div class="action-links"><p><a href="https://jongsoo92.github.io/Biostatistics/edit/main/book/survival_analysis.qmd" class="toc-action">Edit this page</a></p><p><a href="https://jongsoo92.github.io/Biostatistics/issues/new" class="toc-action">Report an issue</a></p><p><a href="https://jongsoo92.github.io/Biostatistics/blob/main/book/survival_analysis.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">생존분석</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="카플란마이어-생존곡선kaplan-meier-survival-curve" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="카플란마이어-생존곡선kaplan-meier-survival-curve"><span class="header-section-number">9.1</span> 카플란마이어 생존곡선(Kaplan-Meier survival curve)</h2>
<p>Q. 40세 이상인 대상자들의 고혈압 진단 나이에 대해 생명표를 구하고 Kaplan-Meier estimator 방법으로 생존율(고혈압 진단 받지 않은 비율)을 구하시오</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>필요한 패키지를 로딩중입니다: ggpubr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
다음의 패키지를 부착합니다: 'survminer'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:survival':

    myeloma</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">read_sav</span>(<span class="st">"HN19_실습.sav"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>final_data <span class="ot">=</span> <span class="fu">subset</span>(data, age <span class="sc">&gt;=</span><span class="dv">40</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Life table</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(DI1_ag,DI1_dg) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> final_data)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(DI1_ag, DI1_dg) ~ 1, data = final_data)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
   18    357       1    0.997 0.00280        0.992        1.000
   27    356       1    0.994 0.00395        0.987        1.000
   31    355       1    0.992 0.00483        0.982        1.000
   32    354       1    0.989 0.00557        0.978        1.000
   35    353       1    0.986 0.00622        0.974        0.998
   37    352       1    0.983 0.00680        0.970        0.997
   39    351       2    0.978 0.00783        0.962        0.993
   40    349       3    0.969 0.00915        0.951        0.987
   41    337       3    0.961 0.01033        0.941        0.981
   43    319       6    0.942 0.01250        0.918        0.967
   44    303       1    0.939 0.01284        0.915        0.965
   45    294       5    0.923 0.01447        0.895        0.952
   46    277       1    0.920 0.01480        0.892        0.950
   47    272       3    0.910 0.01575        0.880        0.941
   48    261       3    0.899 0.01669        0.867        0.933
   49    252       7    0.874 0.01871        0.839        0.912
   50    237       4    0.860 0.01979        0.822        0.899
   51    221       2    0.852 0.02036        0.813        0.893
   52    213       3    0.840 0.02122        0.799        0.883
   53    203       6    0.815 0.02289        0.771        0.861
   54    188       4    0.798 0.02399        0.752        0.846
   55    180       5    0.776 0.02529        0.728        0.827
   56    169       4    0.757 0.02630        0.707        0.811
   57    159       1    0.752 0.02656        0.702        0.806
   58    152       4    0.733 0.02765        0.680        0.789
   59    138       3    0.717 0.02853        0.663        0.775
   60    130       3    0.700 0.02943        0.645        0.760
   61    121       2    0.689 0.03006        0.632        0.750
   62    117       1    0.683 0.03037        0.626        0.745
   63    108       8    0.632 0.03297        0.571        0.700
   64     96       2    0.619 0.03357        0.557        0.688
   65     87       4    0.591 0.03492        0.526        0.663
   66     79       2    0.576 0.03560        0.510        0.650
   67     69       1    0.567 0.03604        0.501        0.642
   68     64       4    0.532 0.03790        0.462        0.612
   70     52       3    0.501 0.03964        0.429        0.585
   71     47       2    0.480 0.04072        0.406        0.567
   73     42       3    0.446 0.04235        0.370        0.537
   75     32       1    0.432 0.04325        0.355        0.525
   76     27       3    0.384 0.04647        0.303        0.486
   78     21       1    0.365 0.04771        0.283        0.472
   79     19       1    0.346 0.04892        0.262        0.457
   80     10       2    0.277 0.05873        0.183        0.420</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>rslt <span class="ot">=</span> <span class="fu">summary</span>(fit,<span class="at">times=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">80</span>,<span class="dv">5</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>rslt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(DI1_ag, DI1_dg) ~ 1, data = final_data)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    0    357       0    1.000 0.00000        1.000        1.000
    5    357       0    1.000 0.00000        1.000        1.000
   10    357       0    1.000 0.00000        1.000        1.000
   15    357       0    1.000 0.00000        1.000        1.000
   20    356       1    0.997 0.00280        0.992        1.000
   25    356       0    0.997 0.00280        0.992        1.000
   30    355       1    0.994 0.00395        0.987        1.000
   35    353       3    0.986 0.00622        0.974        0.998
   40    349       6    0.969 0.00915        0.951        0.987
   45    294      15    0.923 0.01447        0.895        0.952
   50    237      18    0.860 0.01979        0.822        0.899
   55    180      20    0.776 0.02529        0.728        0.827
   60    130      15    0.700 0.02943        0.645        0.760
   65     87      17    0.591 0.03492        0.526        0.663
   70     52      10    0.501 0.03964        0.429        0.585
   75     32       6    0.432 0.04325        0.355        0.525
   80     10       7    0.277 0.05873        0.183        0.420</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rslt<span class="sc">$</span>time,rslt<span class="sc">$</span>surv,<span class="at">type=</span><span class="st">"s"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Kaplan-Meier estimator</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">=</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(DI1_ag,DI1_dg) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">"kaplan-meier"</span>, <span class="at">data =</span> final_data)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="survival_analysis_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="survival_analysis_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># median survival time</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>fit2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(DI1_ag, DI1_dg) ~ 1, data = final_data, 
    type = "kaplan-meier")

       n events median 0.95LCL 0.95UCL
[1,] 357    119     71      68      76</code></pre>
</div>
</div>
</section>
<section id="생존곡선-비교" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="생존곡선-비교"><span class="header-section-number">9.2</span> 생존곡선 비교</h2>
<section id="로그순위검정log-rank-test" class="level3" data-number="9.2.1">
<h3 data-number="9.2.1" class="anchored" data-anchor-id="로그순위검정log-rank-test"><span class="header-section-number">9.2.1</span> 로그순위검정(Log-rank test)</h3>
<p>Q. 40세 이상인 대상자들의 고혈압 진단 나이에 대해 Kaplan-Meier estimator으로 생존함수를 추정하고, smoke 그룹에 따라 생존함수에 차이가 있는지 검정하시오</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">변수명</th>
<th style="text-align: center;">변수설명</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">DI1_ag</td>
<td style="text-align: center;">고혈압 진단 시기(나이)</td>
</tr>
<tr class="even">
<td style="text-align: center;">DI1_dg</td>
<td style="text-align: center;">고혈압 진단 여부 (1. 고혈압 진단, 0. 정상)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">smoke</td>
<td style="text-align: center;">흡연여부 (1. 현재흡연, 2. 과거흡연, 3. 비흡연)</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">=</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(DI1_ag,DI1_dg) <span class="sc">~</span> smoke, <span class="at">type =</span> <span class="st">"kaplan-meier"</span>, <span class="at">data =</span> final_data)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(DI1_ag, DI1_dg) ~ smoke, data = final_data, 
    type = "kaplan-meier")

                smoke=1 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
   27     53       1    0.981  0.0187        0.945        1.000
   41     52       2    0.943  0.0317        0.883        1.000
   43     50       2    0.906  0.0402        0.830        0.988
   45     43       1    0.885  0.0444        0.802        0.976
   46     40       1    0.862  0.0485        0.773        0.963
   47     37       1    0.839  0.0525        0.742        0.949
   49     35       2    0.791  0.0594        0.683        0.917
   53     30       1    0.765  0.0630        0.651        0.899
   55     26       1    0.735  0.0671        0.615        0.879
   56     23       1    0.703  0.0714        0.577        0.858
   63     13       1    0.649  0.0840        0.504        0.837
   65     11       1    0.590  0.0948        0.431        0.809
   68      6       1    0.492  0.1196        0.305        0.792
   70      4       1    0.369  0.1393        0.176        0.773

                smoke=2 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
   18     83       1    0.988  0.0120        0.965        1.000
   37     82       1    0.976  0.0168        0.943        1.000
   39     81       1    0.964  0.0205        0.925        1.000
   40     80       1    0.952  0.0235        0.907        0.999
   41     77       1    0.939  0.0263        0.889        0.992
   43     73       2    0.914  0.0312        0.855        0.977
   45     66       1    0.900  0.0337        0.836        0.968
   49     57       2    0.868  0.0392        0.795        0.949
   50     50       1    0.851  0.0421        0.772        0.938
   53     43       2    0.811  0.0485        0.722        0.912
   55     38       1    0.790  0.0518        0.695        0.898
   57     37       1    0.769  0.0546        0.669        0.883
   58     32       1    0.745  0.0579        0.639        0.867
   60     29       3    0.668  0.0669        0.549        0.812
   61     25       1    0.641  0.0693        0.518        0.792
   63     22       1    0.612  0.0720        0.486        0.771
   64     20       1    0.581  0.0746        0.452        0.748
   68     17       2    0.513  0.0800        0.378        0.696
   71     14       1    0.476  0.0822        0.339        0.668
   73     12       2    0.397  0.0856        0.260        0.606
   78      6       1    0.331  0.0934        0.190        0.575

                smoke=3 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
   31    221       1    0.995 0.00451        0.987        1.000
   32    220       1    0.991 0.00637        0.979        1.000
   35    219       1    0.986 0.00778        0.971        1.000
   39    218       1    0.982 0.00897        0.964        1.000
   40    217       2    0.973 0.01093        0.952        0.995
   43    196       2    0.963 0.01288        0.938        0.988
   44    189       1    0.958 0.01378        0.931        0.985
   45    185       3    0.942 0.01622        0.911        0.975
   47    175       2    0.932 0.01773        0.897        0.967
   48    165       3    0.915 0.01992        0.876        0.954
   49    160       3    0.897 0.02187        0.856        0.941
   50    155       3    0.880 0.02363        0.835        0.928
   51    143       2    0.868 0.02485        0.820        0.918
   52    138       3    0.849 0.02659        0.798        0.903
   53    130       3    0.829 0.02828        0.776        0.887
   54    123       4    0.802 0.03041        0.745        0.864
   55    116       3    0.782 0.03189        0.722        0.847
   56    109       3    0.760 0.03335        0.697        0.828
   58     99       3    0.737 0.03489        0.672        0.809
   59     91       3    0.713 0.03645        0.645        0.788
   61     80       1    0.704 0.03707        0.635        0.780
   62     78       1    0.695 0.03767        0.625        0.773
   63     73       6    0.638 0.04116        0.562        0.724
   64     65       1    0.628 0.04168        0.551        0.715
   65     58       3    0.595 0.04354        0.516        0.687
   66     51       2    0.572 0.04485        0.491        0.667
   67     46       1    0.560 0.04557        0.477        0.656
   68     41       1    0.546 0.04646        0.462        0.645
   70     34       2    0.514 0.04896        0.426        0.619
   71     30       1    0.497 0.05024        0.407        0.606
   73     28       1    0.479 0.05148        0.388        0.591
   75     22       1    0.457 0.05355        0.363        0.575
   76     19       3    0.385 0.05913        0.285        0.520
   79     13       1    0.355 0.06155        0.253        0.499
   80      8       2    0.267 0.07136        0.158        0.450</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(fit3, <span class="at">legend.title=</span><span class="st">"smoke"</span>,<span class="at">legend.labs=</span><span class="fu">c</span>(<span class="st">"current"</span>,<span class="st">"ex smoker"</span>,<span class="st">"non-smoker"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="survival_analysis_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>rslt2 <span class="ot">=</span> <span class="fu">survdiff</span>(<span class="fu">Surv</span>(DI1_ag,DI1_dg) <span class="sc">~</span> smoke, <span class="at">data =</span> final_data)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>rslt2<span class="sc">$</span>chisq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4189026</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rslt2<span class="sc">$</span>pvalue</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8110291</code></pre>
</div>
</div>
</section>
<section id="breslow-test-tarone-ware-test" class="level3" data-number="9.2.2">
<h3 data-number="9.2.2" class="anchored" data-anchor-id="breslow-test-tarone-ware-test"><span class="header-section-number">9.2.2</span> Breslow test &amp; Tarone-Ware test</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("survMisc")</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survMisc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
다음의 패키지를 부착합니다: 'survMisc'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    autoplot</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">ten</span>(fit3)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">comp</span>(t1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              chiSq df pChisq
1          0.418903  2      5
n          1.321260  2      1
sqrtN      0.888488  2      2
S1         0.720640  2      4
S2         0.729227  2      3
FH_p=1_q=1 0.069639  2      6
$tft
                     Q         Var         Z pNorm
1           4.9161e+00  5.8693e+01  0.641697     5
n           1.9430e+03  2.8575e+06  1.149421     1
sqrtN       1.0123e+02  1.1538e+04  0.942400     2
S1          5.1309e+00  3.6583e+01  0.848304     4
S2          5.1325e+00  3.6172e+01  0.853389     3
FH_p=1_q=1 -8.5474e-02  1.5072e+00 -0.069624     6

$scores
[1] 1 2 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-rank test</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">pchisq</span>(<span class="fl">0.4189</span>,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8110302</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Breslow test</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">pchisq</span>(<span class="fl">1.3213</span>,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5165155</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tarone-Ware test</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">pchisq</span>(<span class="fl">0.8885</span>,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6413051</code></pre>
</div>
</div>
</section>
</section>
<section id="콕스비례위험모형cox-proportional-hazard-model" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="콕스비례위험모형cox-proportional-hazard-model"><span class="header-section-number">9.3</span> 콕스비례위험모형(Cox proportional hazard model)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to generate BMI group variable</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>final_data<span class="sc">$</span>BMI_gp <span class="ot">=</span> <span class="fu">ifelse</span>(final_data<span class="sc">$</span>HE_BMI<span class="sc">&lt;=</span><span class="dv">22</span>,<span class="st">"1 light"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">ifelse</span>(final_data<span class="sc">$</span>HE_BMI<span class="sc">&lt;=</span><span class="dv">26</span>,<span class="st">"2 normal"</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ifelse</span>(final_data<span class="sc">$</span>HE_BMI<span class="sc">&gt;</span><span class="dv">26</span>,<span class="st">"3 heavy"</span>,<span class="cn">NA</span>)))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>final_data<span class="sc">$</span>BMI_gp <span class="ot">=</span> <span class="fu">factor</span>(final_data<span class="sc">$</span>BMI_gp)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#final_data$BMI_gp = relevel(final_data$BMI_gp, ref = "3 heavy")</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>cox.fit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(DI1_ag, DI1_dg) <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> HE_chol <span class="sc">+</span> BMI_gp, <span class="at">data =</span> final_data)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(DI1_ag, DI1_dg) ~ age + sex + HE_chol + 
    BMI_gp, data = final_data)

  n= 341, number of events= 114 
   (결측으로 인하여 16개의 관측치가 삭제되었습니다.)

                    coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
age            -0.044977  0.956020  0.012150 -3.702 0.000214 ***
sex             0.085525  1.089289  0.195786  0.437 0.662236    
HE_chol        -0.010243  0.989809  0.002706 -3.786 0.000153 ***
BMI_gp2 normal -0.059136  0.942578  0.239266 -0.247 0.804787    
BMI_gp3 heavy   0.595202  1.813397  0.251939  2.362 0.018153 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

               exp(coef) exp(-coef) lower .95 upper .95
age               0.9560     1.0460    0.9335    0.9791
sex               1.0893     0.9180    0.7421    1.5988
HE_chol           0.9898     1.0103    0.9846    0.9951
BMI_gp2 normal    0.9426     1.0609    0.5897    1.5065
BMI_gp3 heavy     1.8134     0.5515    1.1067    2.9713

Concordance= 0.687  (se = 0.026 )
Likelihood ratio test= 32.49  on 5 df,   p=5e-06
Wald test            = 31.79  on 5 df,   p=7e-06
Score (logrank) test = 31.93  on 5 df,   p=6e-06</code></pre>
</div>
</div>
</section>
<section id="비례위험-가정검토" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="비례위험-가정검토"><span class="header-section-number">9.4</span> 비례위험 가정검토</h2>
<section id="plot을-이용한-방법" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="plot을-이용한-방법"><span class="header-section-number">9.4.1</span> 1. plot을 이용한 방법</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cloglog   </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>cloglog <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(DI1_ag, DI1_dg) <span class="sc">~</span> BMI_gp, <span class="at">data =</span> final_data)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(cloglog, <span class="at">fun =</span> <span class="st">"cloglog"</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">80</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="survival_analysis_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="time-dependent-cox-regression을-이용한-방법" class="level3" data-number="9.4.2">
<h3 data-number="9.4.2" class="anchored" data-anchor-id="time-dependent-cox-regression을-이용한-방법"><span class="header-section-number">9.4.2</span> 2. Time dependent cox regression을 이용한 방법</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>final_data<span class="sc">$</span>BMI_gp <span class="ot">=</span> <span class="fu">ifelse</span>(final_data<span class="sc">$</span>HE_BMI<span class="sc">&lt;=</span><span class="dv">22</span>,<span class="dv">1</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">ifelse</span>(final_data<span class="sc">$</span>HE_BMI<span class="sc">&lt;=</span><span class="dv">26</span>,<span class="dv">2</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ifelse</span>(final_data<span class="sc">$</span>HE_BMI<span class="sc">&gt;</span><span class="dv">26</span>,<span class="dv">3</span>,<span class="cn">NA</span>)))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>final_data<span class="sc">$</span>BMI_gp2 <span class="ot">=</span> <span class="fu">ifelse</span>(final_data<span class="sc">$</span>BMI_gp<span class="sc">==</span><span class="dv">2</span>,<span class="dv">1</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ifelse</span>(final_data<span class="sc">$</span>BMI_gp <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>),<span class="dv">0</span>,<span class="cn">NA</span>))</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>final_data<span class="sc">$</span>BMI_gp3 <span class="ot">=</span> <span class="fu">ifelse</span>(final_data<span class="sc">$</span>BMI_gp<span class="sc">==</span><span class="dv">3</span>,<span class="dv">1</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ifelse</span>(final_data<span class="sc">$</span>BMI_gp <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dv">0</span>,<span class="cn">NA</span>))</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># time variable</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>final_data<span class="sc">$</span>time <span class="ot">=</span> final_data<span class="sc">$</span>DI1_ag</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># event variable</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>final_data<span class="sc">$</span>event <span class="ot">=</span> final_data<span class="sc">$</span>DI1_dg</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 1.</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(DI1_ag,DI1_dg) <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> HE_chol <span class="sc">+</span> BMI_gp2 <span class="sc">+</span> BMI_gp3 <span class="sc">+</span><span class="fu">tt</span>(BMI_gp2)<span class="sc">+</span><span class="fu">tt</span>(BMI_gp3), <span class="at">data=</span>final_data, <span class="at">tt=</span> <span class="cf">function</span>(x,t,...) x<span class="sc">*</span><span class="fu">log</span>(t) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(DI1_ag, DI1_dg) ~ age + sex + HE_chol + 
    BMI_gp2 + BMI_gp3 + tt(BMI_gp2) + tt(BMI_gp3), data = final_data, 
    tt = function(x, t, ...) x * log(t))

                 coef exp(coef)  se(coef)      z        p
age         -0.043714  0.957228  0.012127 -3.605 0.000313
sex          0.063579  1.065644  0.196219  0.324 0.745922
HE_chol     -0.010062  0.989989  0.002676 -3.760 0.000170
BMI_gp2     -5.793835  0.003046  4.395546 -1.318 0.187465
BMI_gp3      3.247787 25.733320  3.922143  0.828 0.407634
tt(BMI_gp2)  1.430893  4.182432  1.096793  1.305 0.192024
tt(BMI_gp3) -0.670871  0.511263  0.990329 -0.677 0.498138

Likelihood ratio test=37.17  on 7 df, p=4.36e-06
n= 341, number of events= 114 
   (결측으로 인하여 16개의 관측치가 삭제되었습니다.)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 2.</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>data.cp <span class="ot">=</span> <span class="fu">survSplit</span>(final_data,<span class="at">cut =</span> final_data<span class="sc">$</span>DI1_ag[final_data<span class="sc">$</span>DI1_dg<span class="sc">==</span><span class="dv">1</span>],<span class="at">end=</span><span class="st">"time"</span>,<span class="at">event=</span><span class="st">"event"</span>, <span class="at">start =</span> <span class="st">"start"</span>, <span class="at">id=</span><span class="st">"ID2"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>data.cp<span class="sc">$</span>logbmi_gp2 <span class="ot">&lt;-</span> data.cp<span class="sc">$</span>BMI_gp2 <span class="sc">*</span> <span class="fu">log</span>(data.cp<span class="sc">$</span>time)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>data.cp<span class="sc">$</span>logbmi_gp3 <span class="ot">&lt;-</span> data.cp<span class="sc">$</span>BMI_gp3 <span class="sc">*</span> <span class="fu">log</span>(data.cp<span class="sc">$</span>time)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># time dependent cox regression</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> <span class="fu">Surv</span>(data.cp<span class="sc">$</span>start, data.cp<span class="sc">$</span>time, data.cp<span class="sc">$</span>event)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>cox.rslt <span class="ot">=</span> <span class="fu">coxph</span>(Y <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> HE_chol <span class="sc">+</span> BMI_gp2 <span class="sc">+</span> BMI_gp3 <span class="sc">+</span> logbmi_gp2 <span class="sc">+</span> logbmi_gp3 <span class="sc">+</span> <span class="fu">cluster</span>(ID2), <span class="at">data =</span> data.cp)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox.rslt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Y ~ age + sex + HE_chol + BMI_gp2 + BMI_gp3 + 
    logbmi_gp2 + logbmi_gp3, data = data.cp, cluster = ID2)

  n= 7707, number of events= 114 
   (결측으로 인하여 437개의 관측치가 삭제되었습니다.)

                coef exp(coef)  se(coef) robust se      z Pr(&gt;|z|)    
age        -0.043714  0.957228  0.012127  0.011667 -3.747 0.000179 ***
sex         0.063579  1.065644  0.196219  0.199395  0.319 0.749832    
HE_chol    -0.010062  0.989989  0.002676  0.002918 -3.448 0.000564 ***
BMI_gp2    -5.793835  0.003046  4.395546  5.252839 -1.103 0.270031    
BMI_gp3     3.247787 25.733320  3.922143  3.362840  0.966 0.334151    
logbmi_gp2  1.430893  4.182432  1.096793  1.308988  1.093 0.274337    
logbmi_gp3 -0.670871  0.511263  0.990329  0.855708 -0.784 0.433043    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

           exp(coef) exp(-coef) lower .95 upper .95
age         0.957228    1.04468 9.356e-01 9.794e-01
sex         1.065644    0.93840 7.209e-01 1.575e+00
HE_chol     0.989989    1.01011 9.843e-01 9.957e-01
BMI_gp2     0.003046  328.26962 1.029e-07 9.016e+01
BMI_gp3    25.733320    0.03886 3.532e-02 1.875e+04
logbmi_gp2  4.182432    0.23910 3.215e-01 5.441e+01
logbmi_gp3  0.511263    1.95594 9.556e-02 2.735e+00

Concordance= 0.684  (se = 0.027 )
Likelihood ratio test= 37.17  on 7 df,   p=4e-06
Wald test            = 36.33  on 7 df,   p=6e-06
Score (logrank) test = 37.54  on 7 df,   p=4e-06,   Robust = 26.36  p=4e-04

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).</code></pre>
</div>
</div>
</section>
<section id="schoenfeld-residual을-이용한-방법" class="level3" data-number="9.4.3">
<h3 data-number="9.4.3" class="anchored" data-anchor-id="schoenfeld-residual을-이용한-방법"><span class="header-section-number">9.4.3</span> 3. Schoenfeld residual을 이용한 방법</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>cox.fit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(DI1_ag, DI1_dg) <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> HE_chol <span class="sc">+</span> BMI_gp, <span class="at">data =</span> final_data)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">cox.zph</span>(cox.fit, <span class="at">transform =</span> <span class="st">'log'</span>) </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(temp) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        chisq df     p
age     1.752  1 0.186
sex     2.995  1 0.084
HE_chol 3.891  1 0.049
BMI_gp  0.875  1 0.350
GLOBAL  9.630  4 0.047</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(temp) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="survival_analysis_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./logistic_regression.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">로지스틱 회귀분석</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./sample_size_in_clinical_trial.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Sample size in Clinical Trial</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>